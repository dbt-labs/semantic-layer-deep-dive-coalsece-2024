semantic_models:
  - name: customers
    description: customer record book, unique customer id
    model: ref('customers')
    defaults:
      agg_time_dimension: first_ordered_at
  
    entities:
      - name: customer_id
        type: primary  
        expr: customer_id

    dimensions:
      - name: customer_type
        type: CATEGORICAL
        expr: CUSTOMER_TYPE
      - name: first_ordered_at
        type: time
        type_params:
          time_granularity: day
        expr: FIRST_ORDERED_AT
      - name: last_ordered_at
        type: time
        type_params:
          time_granularity: day
        expr: LAST_ORDERED_AT

    measures:
    - name: customer_lifetime_spend
      description: customer spend after tax
      agg: sum
      expr: LIFETIME_SPEND

    - name: count_lifetime_orders
      description: number of orders per customers
      agg: sum
      expr: COUNT_LIFETIME_ORDERS

    - name: count_customers
      description: number of customers
      agg: count_distinct
      expr: customer_id
      
metrics:
- name: total_customer_lifetime_spend
  description: Total lifetime spend by customer
  type: simple
  label: Total Customer Spend
  type_params:
    measure:
      name: customer_lifetime_spend

- name: total_count_lifetime_orders
  description: Total orders by customer
  type: simple
  label: Total Orders by Customer
  type_params:
    measure:
      name: count_lifetime_orders

- name: total_customers
  description: Total number of customers
  type: simple
  label: Total Number of Customers
  type_params:
    measure:
      name: count_customers

- name: average_spend_per_customer
  description: Average Spend per Customer
  type: ratio
  label:  Average Spend per Customer
  type_params:
    numerator: 
      name: total_customer_lifetime_spend
    denominator: 
      name: total_customers